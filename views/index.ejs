<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= pageTitle %></title>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
    
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>

    <div class="sidebar">
        <div class="sidebar-header">
            <img src="/gdz.png" alt="GDZ Elektrik Logo" onerror="this.style.display='none'">
        </div>

        <div class="menu-item active" onclick="showSection('dashboard', this)"><i class="fas fa-home"></i> Anasayfa</div>
        
        <div class="menu-item" onclick="showSection('bolgesel-goruntuleme', this); initMapOnce();"><i class="fas fa-map-marked-alt"></i> B√∂lgesel G√∂r√ºnt√ºleme</div>
        
        <div class="menu-item" onclick="showSection('tuketim-trendi', this)"><i class="fas fa-chart-line"></i> T√ºketim Trendi</div>
        <div class="menu-item" onclick="showSection('tuketim-tahmin', this)"><i class="fas fa-crystal-ball"></i> T√ºketim Tahmini</div>
        <div class="menu-item" onclick="showSection('kesinti-analiz', this)"><i class="fas fa-chart-pie"></i> Kesinti Nedenleri</div>

        <a href="/logout" class="menu-item logout-btn">
            <i class="fas fa-sign-out-alt"></i> √áƒ±kƒ±≈ü Yap
        </a>
    </div>

    <div class="content">

        <div id="dashboard" class="section active">
            
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                <h2><i class="fas fa-tachometer-alt"></i> Aylƒ±k Y√∂netici Paneli</h2>
                <div style="background: white; padding: 10px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); display: flex; gap: 10px; align-items: center;">
                    <label style="margin:0; font-weight: bold; color: #555;">D√∂nem:</label>
                    <input type="month" id="kpiDate" value="2024-03" style="border: 1px solid #ccc; padding: 5px; border-radius: 4px;" onchange="updateDashboard()">
                    <button onclick="updateDashboard()" style="padding: 5px 15px; font-size: 13px;">Getir</button>
                </div>
            </div>
            
            <div class="kpi-container">
                <div class="kpi-card blue"><div class="kpi-icon"><i class="fas fa-bolt"></i></div><div class="kpi-info"><h4>Toplam T√ºketim</h4><span id="kpiTuketim">...</span></div></div>
                <div class="kpi-card orange"><div class="kpi-icon"><i class="fas fa-chart-line"></i></div><div class="kpi-info"><h4>Deƒüi≈üim (%)</h4><span id="kpiDegisim">...</span></div></div>
                <div class="kpi-card green"><div class="kpi-icon"><i class="fas fa-crown"></i></div><div class="kpi-info"><h4>En Y√ºksek T√ºketim</h4><span id="kpiSampiyon">...</span></div></div>
                <div class="kpi-card red"><div class="kpi-icon"><i class="fas fa-exclamation-triangle"></i></div><div class="kpi-info"><h4>Kesinti Sayƒ±sƒ±</h4><span id="kpiKesinti">...</span></div></div>
            </div>

            <div class="row">
                <div class="col">
                    <div class="card">
                        <h2><i class="fas fa-city"></i> ƒ∞l√ße Tipine G√∂re T√ºketim Daƒüƒ±lƒ±mƒ±</h2>
                        <div class="chart-container">
                            <canvas id="chartTipDagilim"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <div class="card">
                <h2> EN Y√úKSEK 8 ƒ∞L√áE ANALƒ∞Zƒ∞ (T√úKETƒ∞M & ARIZA) </h2>
                
                <div class="controls" style="margin-top: 0;">
                    <div class="form-group"><label>Ba≈ülangƒ±√ß:</label><input type="month" id="top8Start" value="2024-01"></div>
                    <div class="form-group"><label>Biti≈ü:</label><input type="month" id="top8End" value="2024-12"></div>
                    <button onclick="updateTop8Charts()">Listele</button>
                </div>

                <div class="row">
                    <div class="col">
                        <div class="chart-container">
                            <canvas id="chartTop8Tuketim"></canvas>
                        </div>
                    </div>
                    <div class="col">
                        <div class="chart-container">
                            <canvas id="chartTop8Ariza"></canvas>
                        </div>
                    </div>
                </div>
            </div>
            
        </div>

        <div id="bolgesel-goruntuleme" class="section">
            <div class="card">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h2><i class="fas fa-map-marked-alt"></i> ƒ∞zmir B√∂lgesel Analiz Haritasƒ±</h2>
                    <div class="controls" style="margin:0; padding: 5px; background:none;">
                        <div class="form-group">
                            <label>Ba≈ülangƒ±√ß:</label>
                            <input type="month" id="mapStart" value="2024-01" onchange="updateSelectedCharts()">
                        </div>
                        <div class="form-group">
                            <label>Biti≈ü:</label>
                            <input type="month" id="mapEnd" value="2024-12" onchange="updateSelectedCharts()">
                        </div>
                        <div style="font-size: 13px; color: #7f8c8d; margin-left: 15px;">
                            <i class="fas fa-info-circle"></i> Kar≈üƒ±la≈ütƒ±rma i√ßin haritadan 2 il√ße se√ßin.
                        </div>
                    </div>
                </div>
                
                <div id="map"></div>

                <div id="kdsKarsilastirmaPanel" class="kds-card" style="display: none; margin-bottom: 20px; animation: fadeIn 0.5s;">
                    <div class="kds-score">
                        <h1 id="kdsKarsilastirmaIcon" style="font-size: 50px;">‚öñÔ∏è</h1>
                        <span id="kdsKarsilastirmaBadge" class="kds-badge">ANALƒ∞Z</span>
                    </div>
                    <div class="kds-content">
                        <h5 id="kdsKarsilastirmaBaslik">B√ñLGESEL KAR≈ûILA≈ûTIRMA</h5>
                        <p id="kdsKarsilastirmaMesaj">ƒ∞ki b√∂lge arasƒ±ndaki veriler analiz ediliyor...</p>
                        <div style="margin-top: 15px; padding: 10px; background: rgba(0,0,0,0.03); border-radius: 5px; border-left: 3px solid #34495e;">
                            <strong>üí° KDS YATIRIM TAVSƒ∞YESƒ∞:</strong> <span id="kdsKarsilastirmaOneri">...</span>
                        </div>
                    </div>
                </div>

                <div id="chartsArea" style="display: none;">
                    
                    <h3 style="color: #3498db; margin: 20px 0 10px 0; font-size: 16px; border-bottom: 1px solid #ddd;">‚ö° Aylƒ±k T√ºketim Analizi</h3>
                    <div class="chart-row">
                        <div class="chart-col" id="colTuketim1" style="display: none;">
                            <div class="chart-container"><canvas id="chartMapTuketim1"></canvas></div>
                        </div>
                        <div class="chart-col" id="colTuketim2" style="display: none;">
                            <div class="chart-container"><canvas id="chartMapTuketim2"></canvas></div>
                        </div>
                    </div>

                    <h3 style="color: #e74c3c; margin: 20px 0 10px 0; font-size: 16px; border-bottom: 1px solid #ddd;">‚ö†Ô∏è Aylƒ±k Arƒ±za Analizi</h3>
                    <div class="chart-row">
                        <div class="chart-col" id="colAriza1" style="display: none;">
                            <div class="chart-container"><canvas id="chartMapAriza1"></canvas></div>
                        </div>
                        <div class="chart-col" id="colAriza2" style="display: none;">
                            <div class="chart-container"><canvas id="chartMapAriza2"></canvas></div>
                        </div>
                    </div>

                </div>
                
                <div id="emptyState" style="text-align: center; padding: 40px; color: #95a5a6;">
                    <i class="fas fa-mouse-pointer" style="font-size: 40px; margin-bottom: 10px;"></i>
                    <p>Verilerini g√∂rmek i√ßin haritadan bir veya iki il√ße se√ßiniz.</p>
                </div>
            </div>
        </div>

        <div id="tuketim-trendi" class="section">
            <div class="card">
                <h2>Genel T√ºketim Trendi</h2>
                <div class="controls">
                    <div class="form-group"><label>Ba≈ülangƒ±√ß:</label><input type="month" id="trendStart" value="2024-01"></div>
                    <div class="form-group"><label>Biti≈ü:</label><input type="month" id="trendEnd" value="2025-12"></div>
                    <button onclick="getTrendData()">Analiz Et</button>
                </div>
                <div class="chart-container"><canvas id="chartTrend"></canvas></div>
            </div>
        </div>

        <div id="tuketim-tahmin" class="section">
            <div class="card">
                <h2>2026 T√ºketim Tahmini</h2>
                <div class="controls">
                    <div class="form-group">
                        <label>ƒ∞l√ße:</label>
                        <select id="tahminIlce">
                            <% ilceler.forEach(ilce => { %> 
                                <option value="<%= ilce.id %>"><%= ilce.ad %></option> 
                            <% }) %>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>√áeyrek:</label>
                        <select id="tahminCeyrek">
                            <option value="all">T√ºm Yƒ±l</option>
                            <option value="1">1. √áeyrek</option>
                            <option value="2">2. √áeyrek</option>
                            <option value="3">3. √áeyrek</option>
                            <option value="4">4. √áeyrek</option>
                        </select>
                    </div>
                    <button onclick="updateTahminChart()">Olu≈ütur</button>
                </div>
                
                <div class="chart-container"><canvas id="chartTahmin"></canvas></div>
                
                <div id="tahminAnalizKarti" class="kds-card" style="display: none;">
                    <div class="kds-score">
                        <h1 id="kdsOran">%0</h1>
                        <span id="kdsBadge" class="kds-badge">...</span>
                    </div>
                    <div class="kds-content">
                        <h5><i class="fas fa-robot"></i> GDZ Sistem Analizi ve √ñnerisi:</h5>
                        <p id="kdsMesaj">Analiz y√ºkleniyor...</p>
                    </div>
                </div>

            </div>
        </div>

        <div id="kesinti-analiz" class="section">
            <div class="card">
                <h2>Kesinti Nedenleri</h2>
                <div class="controls"><div class="form-group"><label>ƒ∞l√ße:</label><select id="pieIlce" onchange="updatePieChart()"><% ilceler.forEach(ilce => { %> <option value="<%= ilce.id %>"><%= ilce.ad %></option> <% }) %></select></div></div>
                <div class="chart-container" style="max-width: 600px; margin: 0 auto;"><canvas id="chartPie"></canvas></div>
                
                <div id="kesintiAnalizKarti" class="kds-card" style="display: none; margin-top: 30px;">
                    <div class="kds-score">
                        <div style="font-size: 40px;" id="kesintiIcon">‚ö†Ô∏è</div>
                    </div>
                    <div class="kds-content">
                        <h5 id="kesintiBaslik">ANALƒ∞Z YAPILIYOR...</h5>
                        <p id="kesintiMesaj" style="font-size: 14px;">Veriler inceleniyor.</p>
                        <div style="margin-top: 10px;">
                            <span id="kesintiAction" class="badge bg-dark text-white">Aksiyon √ñnerisi</span>
                        </div>
                    </div>
                </div>

            </div>
        </div>

    </div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

    <script>
        // Bu deƒüi≈üken dashboard.js dosyasƒ±nda kullanƒ±lacak
        const dbIlceler = <%- JSON.stringify(ilceler) %>;
    </script>
    
    <script src="/js/dashboard.js"></script>

</body>
</html>